
Ti.Database.install("database/redditDB.sqlite", "redditTable");

var success = function(){
	alert("Mildly Interesting was succesfully loaded.  Prepare to be mildly interested!");
	console.log("this.responseText");
	var replyData = JSON.parse(this.responseText);
	
	var posts = replyData.data.children;
	var read = function(){
	var db = Ti.Database.open("redditTable");
	var dbRows = db.execute("SELECT id, url, author, ups FROM redditTable");
	while (dbRows.isValidRow()) {
		tblData.push({
			id: dbRows.fieldByName('id'),
			url: dbRows.fieldByName('url'),
			author: dbRows.fieldByName('author'),
			ups: dbRows.fieldByName('ups'),
		});
	}

	for (var i=0; i<posts.length; i++){
		var pic = dbRows[i].data.url;
		var author = dbRows[i].data.author;
		var upvotes = dbRows[i].data.ups;
		var ending = pic.substring((pic.length - 3), pic.length);
		console.log(ending);
		
		if(ending === "jpg" || ending === "gif" || ending === "png"){
			var title = posts[i].data.title;
			
			var view = Ti.UI.createView({
				backgroundColor: "black",
				bottom: 3,
				picture: pic,
				title: title,
				height: Ti.UI.SIZE
			});
			var label = Ti.UI.createLabel({
				text: title,
				color: "black",
				font: {fontFamily: "Roboto", fontSize: "14"},
				top: 3,
				bottom: 3,
				left: 10,
				right: 10,
				textAlign: "center",
				picture: pic,
				author: author,
				height: "auto",
				votes: upvotes
			});
			view.add(label);
			scrollView.add(view);
			label.addEventListener("click", showPic);
		}	
		
		
		dbRows.next();
	}
	dbRows.close();
	db.close();
};
exports.read = read;
	
	
};


